;================================ PJSIP.CONF ==================================
; Configuração PJSIP para testes SIPX com 3 políticas de autenticação

[global]
type=global
max_forwards=70
user_agent=Asterisk-SIPX-Test
default_outbound_endpoint=default_endpoint

[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060

[transport-tcp]
type=transport
protocol=tcp
bind=0.0.0.0:5060

;================================ ACLs ==================================
; ACL para permitir OPTIONS sem autenticação (usado pelo 2222)
[acl-local]
type=acl
deny=0.0.0.0/0.0.0.0
permit=192.168.0.0/16
permit=172.16.0.0/12
permit=10.0.0.0/8
permit=127.0.0.1/32

;================================ TEMPLATES ==================================

[endpoint-basic](!)
type=endpoint
context=sipx-test
disallow=all
allow=ulaw
allow=alaw
allow=gsm
allow=g722
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
ice_support=yes
allow_subscribe=yes

[auth-userpass](!)
type=auth
auth_type=userpass

[aor-single-reg](!)
type=aor
max_contacts=1
remove_existing=yes

;================================ IDENTIFICAÇÃO DE PEERS ==================================
; Identificação para permitir ou negar OPTIONS baseado em IP
[identify-2222]
type=identify
endpoint=2222
match=192.168.0.0/16
match=172.16.0.0/12
match=10.0.0.0/8
match=127.0.0.1/32

;================================ USUÁRIOS DE TESTE ==================================

; ============================================================================
; Usuário 1111 - REQUER AUTENTICAÇÃO PARA TUDO (REGISTER, OPTIONS, INVITE)
; ============================================================================
[1111]
type=endpoint
context=sipx-test
aors=1111
auth=auth1111
disallow=all
allow=ulaw
allow=alaw
allow=gsm
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
; Exige autenticação para OPTIONS e outros métodos
trust_id_inbound=no
trust_id_outbound=no

[auth1111]
type=auth
auth_type=userpass
password=1111xxx
username=1111
realm=asterisk

[1111]
type=aor
max_contacts=5
remove_existing=yes
qualify_frequency=60

; ============================================================================
; Usuário 2222 - OPTIONS SEM AUTENTICAÇÃO, REGISTER/INVITE COM AUTENTICAÇÃO
; ============================================================================
[2222]
type=endpoint
context=sipx-test
aors=2222
auth=auth2222
disallow=all
allow=ulaw
allow=alaw
allow=gsm
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
; Permite tráfego de redes locais sem autenticação (OPTIONS)
acl=acl-local
trust_id_inbound=yes

[auth2222]
type=auth
auth_type=userpass
password=2222xxx
username=2222
realm=asterisk

[2222]
type=aor
max_contacts=5
remove_existing=yes
qualify_frequency=60

; ============================================================================
; Usuário 3333 - NÃO ACEITA OPTIONS (apenas REGISTER/INVITE)
; ============================================================================
[3333]
type=endpoint
context=sipx-test
aors=3333
auth=auth3333
disallow=all
allow=ulaw
allow=alaw
allow=gsm
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
; Configurações de segurança mais restritivas
trust_id_inbound=no
trust_id_outbound=no
; OPTIONS será rejeitado no dialplan (extensions.conf)

[auth3333]
type=auth
auth_type=userpass
password=3333xxx
username=3333
realm=asterisk

[3333]
type=aor
max_contacts=5
remove_existing=yes
qualify_frequency=60

;================================ DEFAULT ENDPOINT ==================================
[default_endpoint]
type=endpoint
context=sipx-test
disallow=all
allow=ulaw
allow=alaw
transport=transport-udp
